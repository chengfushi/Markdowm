## Java 线程池核心线程数在运行过程中能修改吗？如何修改？
> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)

## 回答重点

**可以动态修改的**。Java 的 `ThreadPoolExecutor` 提供了动态调整核心线程数和最大线程数的方法。

1）**修改核心线程数的方法**：
- 使用 `ThreadPoolExecutor.setCorePoolSize(int corePoolSize)` 方法可以动态修改核心线程数。`corePoolSize` 参数代表线程池中的核心线程数，当池中线程数量少于核心线程数时，会创建新的线程来处理任务。这个修改可以在线程池运行的过程中进行，立即生效。

2）**注意事项**：
- 核心线程数的修改不会中断现有任务，新的核心线程数会在新任务到来时生效。
- `setCorePoolSize()` 方法可以减少核心线程数，但如果当前线程池中的线程数量超过了新的核心线程数，多余的线程不会立即被销毁，直到这些线程空闲后被回收。

## 扩展知识：

### **核心线程数和最大线程数的区别**：
- **核心线程数 (`corePoolSize`)**：线程池会维持这个数量的线程，即使这些线程是空闲的。当有新任务提交时，如果现有线程小于核心线程数，会直接创建新的线程来处理任务。
- **最大线程数 (`maximumPoolSize`)**：当核心线程数已满且队列也满了，线程池会创建非核心线程来处理额外的任务。最大线程数限制了线程池能创建的最大线程数。

### **线程池调整原则**：
- 动态调整线程池大小时，需要确保新的配置不会导致系统资源耗尽。比如，过大的线程池可能会占用过多的 CPU 和内存，反而影响性能。
- 当系统负载发生变化时，可以使用动态调整来优化线程池的资源使用率，例如在系统负载增加时，临时提高核心线程数以应对突发流量,当系统负载下降时，可以减少核心线程数以节省资源。
- 当任务队列长度过长时，可以临时增加核心线程数，以加快任务的处理速度。

### **allowCoreThreadTimeOut 方法**：
- 默认情况下，核心线程不会被回收，即使它们空闲。通过 `allowCoreThreadTimeOut(true)` 可以允许核心线程在空闲时被回收，从而释放系统资源。
- 这在负载波动大的应用场景中非常有用，例如在负载高峰时临时增加核心线程数，低负载时通过回收空闲线程释放资源。


### **线程池监控与调整**：
- 在实际生产环境中，可以通过监控线程池的状态（如当前活跃线程数、队列长度等）来决定是否动态调整线程池大小。
- 可以使用 JMX（Java Management Extensions）来监控 `ThreadPoolExecutor`，结合指标来自动调整线程池大小以优化性能。

### 线程池原理

- [472.你了解 Java 线程池的原理吗？](https://www.mianshiya.com/question/1780933294892806145)

> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)